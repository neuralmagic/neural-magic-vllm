name: run lm-eval accuracy test
description: 'run lm-eval accuracy test'
inputs:
  lm_eval_configuration:
    description: 'file containing test configuration'
    required: true
runs:
  using: composite
  steps:
  - id: lm-eval
    run: |
      pip3 install git+https://github.com/EleutherAI/lm-evaluation-harness.git@262f879a06aa5de869e5dd951d0ff2cf2f9ba380
      pip3 install pytest openai==1.3.9

      SUCCESS=0
      ./.github/scripts/nm-run-lm-eval-vllm.sh -c ${{ inputs.lm_eval_configuration }} || SUCCESS=$?
      echo "lm_eval=${SUCCESS}" >> "$GITHUB_OUTPUT"
      exit ${SUCCESS}
    shell: bash
